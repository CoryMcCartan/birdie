<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Weighted Estimate of (Discrete) Outcomes By Race — est_weighted • birdie</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Weighted Estimate of (Discrete) Outcomes By Race — est_weighted"><meta name="description" content='Calculates the "standard" weighted estimator of conditional distributions of
an outcome variable \(Y\) by race \(R\), using BISG probabilities.  This
estimator, while commonly used, is only appropriate if \(Y \perp R \mid X, S\),
where \(S\) and \(X\) are the last names and covariates (possibly
including geography) used in making the BISG probabilities. In most cases
this assumption is not plausible and birdie() should be used instead. See
the references below for more discussion as to selecting the right estimator.
Up to Monte Carlo error, the weighted estimate is equivalent to performing
multiple imputations of the race vector from the BISG probabilities and then
using them inside a weighted average or linear regression.'><meta property="og:description" content='Calculates the "standard" weighted estimator of conditional distributions of
an outcome variable \(Y\) by race \(R\), using BISG probabilities.  This
estimator, while commonly used, is only appropriate if \(Y \perp R \mid X, S\),
where \(S\) and \(X\) are the last names and covariates (possibly
including geography) used in making the BISG probabilities. In most cases
this assumption is not plausible and birdie() should be used instead. See
the references below for more discussion as to selecting the right estimator.
Up to Monte Carlo error, the weighted estimate is equivalent to performing
multiple imputations of the race vector from the BISG probabilities and then
using them inside a weighted average or linear regression.'><meta property="og:image" content="http://corymccartan.com/birdie/logo.png"><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-2KH5JZ6JS1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-2KH5JZ6JS1');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">birdie</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/birdie.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CoryMcCartan/birdie/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate Weighted Estimate of (Discrete) Outcomes By Race</h1>
      <small class="dont-index">Source: <a href="https://github.com/CoryMcCartan/birdie/blob/main/R/weighted.R" class="external-link"><code>R/weighted.R</code></a></small>
      <div class="d-none name"><code>est_weighted.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculates the "standard" weighted estimator of conditional distributions of
an outcome variable \(Y\) by race \(R\), using BISG probabilities.  This
estimator, while commonly used, is only appropriate if \(Y \perp R \mid X, S\),
where \(S\) and \(X\) are the last names and covariates (possibly
including geography) used in making the BISG probabilities. In most cases
this assumption is not plausible and <code><a href="birdie.html">birdie()</a></code> should be used instead. See
the references below for more discussion as to selecting the right estimator.</p>
<p>Up to Monte Carlo error, the weighted estimate is equivalent to performing
multiple imputations of the race vector from the BISG probabilities and then
using them inside a weighted average or linear regression.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">est_weighted</span><span class="op">(</span></span>
<span>  <span class="va">r_probs</span>,</span>
<span>  <span class="va">formula</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  prefix <span class="op">=</span> <span class="st">"pr_"</span>,</span>
<span>  se_boot <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'est_weighted'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'est_weighted'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-r-probs">r_probs<a class="anchor" aria-label="anchor" href="#arg-r-probs"></a></dt>
<dd><p>A data frame or matrix of BISG probabilities, with one row per
individual. The output of <code><a href="bisg.html">bisg()</a></code> can be used directly here.</p></dd>


<dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>A two-sided formula object describing the estimator structure.
The left-hand side is the outcome variable, which must be discrete.
Subgroups for which to calculate estimates may be specified by adding
covariates on the right-hand side. Subgroup estimates are available with
<code>coef(..., subgroup=TRUE)</code> and <code>tidy(..., subgroup=TRUE)</code>.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>An optional data frame containing the variables named in <code>formula</code>.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>An optional numeric vector specifying weights.</p></dd>


<dt id="arg-prefix">prefix<a class="anchor" aria-label="anchor" href="#arg-prefix"></a></dt>
<dd><p>If <code>r_probs</code> is a data frame, the columns containing racial
probabilities will be selected as those with names starting with <code>prefix</code>.
The default will work with the output of <code><a href="bisg.html">bisg()</a></code>.</p></dd>


<dt id="arg-se-boot">se_boot<a class="anchor" aria-label="anchor" href="#arg-se-boot"></a></dt>
<dd><p>The number of bootstrap replicates to use to compute
an approximate covariance matrix for the estimator. If no bootstrapping is
used, an analytical estimate of standard errors will be returned as <code>$se</code>.
For bootstrapping, when there are fewer than 1,000 individuals or 100 or
fewer replicates, a Bayesian bootstrap is used instead (i.e., weights are
drawn from a \(\text{Dirichlet}(1, 1, ..., 1)\) distribution, which
produces more reliable estimates.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments to generic methods (ignored).</p></dd>


<dt id="arg-object-x">object, x<a class="anchor" aria-label="anchor" href="#arg-object-x"></a></dt>
<dd><p>An object of class <code>est_weighted</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>est_weighted</code>, inheriting from
<code><a href="birdie-class.html">birdie</a></code>, for which many methods are available. The
model estimates may be accessed with <code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code>. Uncertainty estimates, if
available, can be accessed with <code>$se</code> and <code><a href="birdie-class.html">vcov.birdie()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="methods-by-generic-">Methods (by generic)<a class="anchor" aria-label="anchor" href="#methods-by-generic-"></a></h2>

<ul><li><p><code>print(est_weighted)</code>: Print a summary of the model fit.</p></li>
<li><p><code>summary(est_weighted)</code>: Print a more detailed summary of the model fit.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>McCartan, C., Fisher, R., Goldin, J., Ho, D.E., &amp; Imai, K. (2025).
Estimating Racial Disparities when Race is Not Observed. <em>Journal of the
American Statistical Association</em>. Available at
<a href="https://doi.org/10.1080/01621459.2025.2526695" class="external-link">doi:10.1080/01621459.2025.2526695</a>
.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pseudo_vf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">r_probs</span> <span class="op">=</span> <span class="fu"><a href="bisg.html">bisg</a></span><span class="op">(</span><span class="op">~</span> <span class="fu">nm</span><span class="op">(</span><span class="va">last_name</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/utils/zip.html" class="external-link">zip</a></span><span class="op">(</span><span class="va">zip</span><span class="op">)</span>, data<span class="op">=</span><span class="va">pseudo_vf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Process zip codes to remove missing values</span></span></span>
<span class="r-in"><span><span class="va">pseudo_vf</span><span class="op">$</span><span class="va">zip</span> <span class="op">=</span> <span class="fu"><a href="preproc.html">proc_zip</a></span><span class="op">(</span><span class="va">pseudo_vf</span><span class="op">$</span><span class="va">zip</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">est_weighted</span><span class="op">(</span><span class="va">r_probs</span>, <span class="va">turnout</span> <span class="op">~</span> <span class="fl">1</span>, data<span class="op">=</span><span class="va">pseudo_vf</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Weighted estimator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: turnout ~ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Data: pseudo_vf</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of obs: 5,000; groups: 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated distribution:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     white black  hisp asian aian other</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> no  0.315 0.335 0.357 0.468 0.53 0.329</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> yes 0.685 0.665 0.643 0.532 0.47 0.671</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">=</span> <span class="fu">est_weighted</span><span class="op">(</span><span class="va">r_probs</span>, <span class="va">turnout</span> <span class="op">~</span> <span class="va">zip</span>, data<span class="op">=</span><span class="va">pseudo_vf</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">est</span>, subgroup<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 7,416 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    zip   turnout race  estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 28748 no      white    0.276</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 28748 yes     white    0.724</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 28748 no      black    0.340</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 28748 yes     black    0.660</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 28748 no      hisp     0.147</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 28748 yes     hisp     0.853</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 28748 no      asian    0.284</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 28748 yes     asian    0.716</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 28748 no      aian     0.211</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 28748 yes     aian     0.789</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 7,406 more rows</span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cory McCartan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

